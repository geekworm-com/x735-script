#!/bin/bash

set -e

SLEEP=${1:-4}

readonly BTN_GPIO_PATH="/sys/class/gpio"
readonly BUTTON=20

readonly INVALID_CLI_ARG_TYPE="151"

terminate() {
    local -r msg=$1
    local -r err_code=${2:-160}
    echo "${msg}" >&2
    exit "${err_code}"
}

if ! [[ $SLEEP =~ ^[0-9\.]+$ ]] ; then
   terminate "error: sleep time not a number" "${INVALID_CLI_ARG_TYPE}"
fi


# Main method
function __main__ {
  echo "$BUTTON" > /sys/class/gpio/export;
  echo "out" > /sys/class/gpio/gpio$BUTTON/direction
  echo "1" > /sys/class/gpio/gpio$BUTTON/value

  echo "Your device will shutting down in ${SLEEP} seconds..."
  /bin/sleep $SLEEP

  echo "0" > /sys/class/gpio/gpio$BUTTON/value
}

__main__